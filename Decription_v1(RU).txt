Ниже приводится краткое обобщение того, что реализовано в боте на текущем этапе:

Механика каталога

Поддержка категорий (из таблицы Categories), подкатегорий (type) и товаров (Products).
При выборе категории и подкатегории выводится список доступных товаров с учётом их количества (quantity > 0).
Кнопка «Назад» на каждом шаге возвращает на предыдущий уровень (либо в главное меню).
Покупка товаров

Для каждого товара показывается цена и описание, предусмотрена кнопка «Купить».
Логика списания средств, проверка и обновление остатка товара, а также запись факта покупки в БД (таблица Purchase).
Баланс и пополнение

У каждого пользователя в таблице Users есть поле balance, обновляется при покупках и при подтверждении платежей администратором.
Возможность пополнения баланса: выбор суммы, выбор валюты (LTC, TRX) по курсу из таблицы RatesY, отправка скриншота платежа.
Административные функции

Команды /confirm user_id amount и /rejectpay user_id amount (или вариант с инлайн-кнопками, если включён) для подтверждения или отклонения платежа.
При подтверждении платежа – баланс пользователя увеличивается, статус платежа меняется на «confirmed». При отклонении – статус «rejected».
Многоязычность

Поддерживаются два языка (ru/en).
По умолчанию определяется через таблицу Users (поле language) или при первом входе — через user.language_code в качестве fallback.
Кнопка «Сменить язык» позволяет вручную переключить язык, и бот сразу обновляет главное меню.
Главное меню

При команде /start или при нажатии «Назад в меню» выводится приветственное фото и клавиатура главного меню.
Кнопки: «Категории» (переход к выбору категорий), «О боте», «Профиль», «Сменить язык».
Функция «О боте»

Показывает общее описание, количество товаров и количество уникальных категорий (через JOIN).
Профиль

Выводит данные пользователя (username, баланс) и иконку-плейсхолдер профиля.
Кнопка «Назад» или «В главное меню» возвращает обратно в стартовый экран.
Безопасность и внутренние детали

Для подтверждения платежей пользователь должен отправить скриншот, который сохраняется на сервере.
Админ получает уведомление со скриншотом, где может подтвердить или отклонить платёж.
Обработка ошибок

При ошибках (например, фото не отправилось, не найден товар) выводится fallback-сообщение пользователю, а в логах сохраняется подробная информация о сбое.
Таким образом, бот уже имеет все базовые механизмы магазина: каталог с остатками, покупки, систему баланса, подтверждение платежей скриншотами, а также админ-панель для управления платежами и товары в БД. Многое улучшалось по мере отладки (работа с callback_query.from_user вместо message.from_user, обновлённые «Назад»-кнопки, учёт русской/английской локализации и т.д.).

